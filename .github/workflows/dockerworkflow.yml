name: docker deploy
on:
  push:
    branches: [ "docker" ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    container:
      image: maven:3.9.9-eclipse-temurin-21-alpine
    steps:
      - name: checkout
        uses: actions/checkout@v6

      - name: testes
        run: mvn -B verify

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v6

      - name: Login no dockerhub
        uses: docker/login-action@v3
        with:
          username: ${{secrets.DOCKER_USERNAME}}
          password: ${{secrets.DOCKER_PASSWORD}}

      - name: push para o dockerhub
        uses: docker/build-push-action@v6
        with:
          context: .
          push: true
          tags: ${{secrets.DOCKER_USERNAME}}/atv2-iec:latest
